{% extends "_admin_layout.html" %}

{% block content %}
    <div class="content-wrapper">

        <br>
        <section class="content">
            <form method="post" action="/admin/feedback/topic/add" onsubmit="return confirmvalidation()"
                  enctype="multipart/form-data">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Feedback Topic</h3>
                    </div>
                    <div class="card-body">
                        <input type="hidden" name="feedback_topic_id" id="feedback_topic_id"
                               value="{% if feedback_topic_id %}{{ feedback_topic_id }}{% else %}{{ "" }}{% endif %}">
                        <div class="row">
                            <div class="col-md-12">
                                Feedback Topic*
                                <input type="text" class="form-control" name="feedback_topic" id="feedback_topic"
                                       value="{{ rs_edit['feedback_topic'] }}">
                                <span class="errmsg flash" id="errfeedback_topic" style="color: red;"></span>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-12">
                                Course
                                <label for="course_id"></label>
                                <select class="form-control" name="course_id" id="course_id">
                                    <option value="">Select Course</option>
                                    {% for course in courses %}
                                        {% if course['course_id'] == rs_edit['course_id'] %}
                                            <option value="{{ course['course_id'] }}"
                                                    selected>{{ course['course_description'] }}</option>
                                        {% else %}
                                            <option value="{{ course['course_id'] }}">{{ course['course_description'] }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                <span class="errmsg flash" id="errstudentclass" style="color: red;"></span>
                            </div>
                            <div class="col-md-12">
                                <br>Faculty
                                <select class="form-control" name="faculty_id" id="faculty_id">
                                    <option value="">Select Faculty</option>
                                    {% for faculty in faculties %}
                                        {% if faculty['faculty_id'] == rs_edit['faculty_id'] %}
                                            <option value="{{ faculty['faculty_id'] }}"
                                                    selected>{{ faculty['faculty_name'] + " - "+ faculty['faculty_designation'] }}</option>
                                        {% else %}
                                            <option value="{{ faculty['faculty_id'] }}">{{ faculty['faculty_name'] + " - "+ faculty['faculty_designation'] }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                <span class="errmsg flash" id="errstudentclass" style="color: red;"></span>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-12">
                                Feedback Topic Description
                                <textarea class="form-control" name="feedbacktopic_detail"
                                          id="feedbacktopic_detail">{{ rs_edit['feedbacktopic_detail'] }}</textarea>
                                <span class="errmsg flash" id="errfeedbacktopic_detail" style="color: red;"></span>
                            </div>
                        </div>
                        <br>
                        <div class="col-md-6">
                            Feedback Viewer Type*
                            <select name="feedback_disptype" id="feedback_disptype" class="form-control" required>
                                <option value="">Select option</option>
                                {% set viewer = ["Pagination Viewer","One Page Viewer"] %}
                                {% for view in viewer %}
                                    {% if view == rs_edit['feedback_disptype'] %}
                                        <option value='{{ view }}' selected>{{ view }}</option>";
                                    {% else %}
                                        <option value='{{ view }}'>{{ view }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <span class="errmsg flash" id="errfeedback_disptype" style="color: red;"></span>
                        </div>
                    </div>
                    <br>
                </div>
                <div class="card-footer">
                    <div class="row">
                        {% if feedback_topic_id %}
                            <div class="col-md-4">
                                <input class="form-control" type="submit" name="submit" id="submit"
                                       value="Update Question Paper">
                            </div>
                            <div class="col-md-8" style="text-align: right;">
                                <b>{{ rs_edit['feedbacktopic_status'] }}</b> |
                                <a href="/admin/feedback/topic?feedbacktopicid={{ feedback_topic_id }}&st=Approved"
                                   class="btn btn-primary">Activate</a>
                                <a href="/admin/feedback/topic?feedbacktopicid={{ feedback_topic_id }}&st=Rejected"
                                   class="btn btn-secondary">Deactivate</a>
                                <a href="/admin/feedback/topic?feedbacktopicid={{ feedback_topic_id }}&del=True"
                                   class="btn btn-danger" onclick="return validatedel()">Delete Feedback</a>
                            </div>
                        {% else %}
                            <div class="col-md-12">
                                <center><input class="btn btn-info" type="submit" name="submit" id="submit"
                                               value="Post Feedback"></center>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </form>
        </section>
    </div>
    {% if feedback_topic_id %}
        <!-- Main content -->
        <section class="content" style="margin-left: 4.6rem !important; padding: 0 0.5rem;">
            <form method="post" action="" onsubmit="return confirmvalidation1()" enctype="multipart/form-data">
                <!-- Default box -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Add Feedback Questions</h3>
                    </div>
                    <div class="card-body">

                        <div class="row">
                            <div class="col-md-12">
                                <b>Question Type*</b>
                                <select class="form-control" name="question_type" id="question_type" required>
                                    <option value=''>Select Question Type</option>
                                    {% set arr = ["Radio Button","Check Box","Text Box"] %}
                                    {% for val in arr %}
{#                                        {% if rs_question_edit['question_type'] == val %}#}
                                        {% if True %}
                                            <option value='$val' selected>$val</option>
                                        {% else %}
                                            <option value='$val'>$val</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                <span class="errmsg flash" id="errquestion_type" style="color: red;"></span>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-12">
                                <b>Question*</b>
                                <textarea class="form-control" name="question"
                                          id="question"><?php echo $rs_question_edit['question']; ?></textarea>
                                <span class="errmsg flash" id="errquestion" style="color: red;"></span>
                            </div>
                        </div>
                        <br>
                        <div id="idhidden">
                            <div class="row">
                                <div class="col-md-6">
                                    <b>Option 1*</b>
                                    <textarea class="form-control" name="option1"
                                              id="option1"><?php echo $rs_question_edit['option1']; ?></textarea>
                                    <span class="errmsg flash" id="erroption1" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <b>Option 2</b>
                                    <textarea class="form-control" name="option2"
                                              id="option2"><?php echo $rs_question_edit['option2']; ?></textarea>
                                    <span class="errmsg flash" id="erroption2" style="color: red;"></span>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <b>Option 3</b>
                                    <textarea class="form-control" name="option3"
                                              id="option3"><?php echo $rs_question_edit['option3']; ?></textarea>
                                    <span class="errmsg flash" id="erroption3" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <b>Option 4</b>
                                    <textarea class="form-control" name="option4"
                                              id="option4"><?php echo $rs_question_edit['option4']; ?></textarea>
                                    <span class="errmsg flash" id="erroption4" style="color: red;"></span>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <b>Option 5</b>
                                    <textarea class="form-control" name="option5"
                                              id="option5"><?php echo $rs_question_edit['option5']; ?></textarea>
                                    <span class="errmsg flash" id="erroption5" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <b>Option 6</b>
                                    <textarea class="form-control" name="option6"
                                              id="option6"><?php echo $rs_question_edit['option6']; ?></textarea>
                                    <span class="errmsg flash" id="erroption6" style="color: red;"></span>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <b>Option 7</b>
                                    <textarea class="form-control" name="option7"
                                              id="option7"><?php echo $rs_question_edit['option7']; ?></textarea>
                                    <span class="errmsg flash" id="erroption7" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <b>Option 8</b>
                                    <textarea class="form-control" name="option8"
                                              id="option8"><?php echo $rs_question_edit['option8']; ?></textarea>
                                    <span class="errmsg flash" id="erroption8" style="color: red;"></span>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <b>Option 9</b>
                                    <textarea class="form-control" name="option9"
                                              id="option9"><?php echo $rs_question_edit['option9']; ?></textarea>
                                    <span class="errmsg flash" id="erroption9" style="color: red;"></span>
                                </div>
                                <div class="col-md-6">
                                    <b>Option 10</b>
                                    <textarea class="form-control" name="option10"
                                              id="option10"><?php echo $rs_question_edit['option10']; ?></textarea>
                                    <span class="errmsg flash" id="erroption10" style="color: red;"></span>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                    <!-- /.card-body -->
                    <div class="card-footer">

                        <div class="row">
                            <div class="col-md-4"></div>
                            <div class="col-md-5">
                                <input class="form-control" type="submit" name="submitquestion" id="submitquestion"
                                       value="Add Question">
                            </div>
                            <div class="col-md-4"></div>
                        </div>
                    </div>
                    <!-- /.card-footer-->
                </div>
                <!-- /.card -->
            </form>
        </section>
        <!-- /.content -->

        <!-- Main content -->
        <section class="content" style="margin-left: 4.6rem !important; padding: 0 0.5rem;">
            <form method="post" action="" onsubmit="return confirmvalidation2()" enctype="multipart/form-data">
                <!-- Default box -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">View Feedback Questions</h3>
                    </div>
                    <div class="card-body">
                        <table id="tblquestionviewer" class="table table-striped table-bordered">
                            <thead>
                            <tr>
                                <th>Number of Questions :
                                    <?php
			$sqlqz ="SELECT * FROM feedbackquestion WHERE feedbacktopicid='$_GET[feedbacktopicid]'";
			$qsqlqz  = mysqli_query($con,$sqlqz);
			echo mysqli_num_rows($qsqlqz);
			?>
                                </th>
                            </tr>
                            </thead>
                            <tbody>

                            <?php
while($rsqz = mysqli_fetch_array($qsqlqz))
{
?>
                            <tr>
                                <td>
                                    <input type="hidden" name="edfeedbackquestionid" id="edfeedbackquestionid"
                                           value="<?php echo $rsqz['feedbackquestionid']; ?>">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <b>Question*</b>
                                            <textarea class="form-control" name="edquestion"
                                                      id="edquestion"><?php echo $rsqz['question']; ?></textarea>
                                            <span class="errmsg flash" id="erredquestion" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>
                                    <?php
if($rsqz['question_type'] == "Radio Button" || $rsqz['question_type'] == "Check Box")
{
?>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Option 1*</b>
                                            <textarea class="form-control" name="edoption1" id="edoption1"
                                                      required><?php echo $rsqz['option1']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption1" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <b>Option 2</b>
                                            <textarea class="form-control" name="edoption2"
                                                      id="edoption2"><?php echo $rsqz['option2']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption2" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Option 3</b>
                                            <textarea class="form-control" name="edoption3"
                                                      id="edoption3"><?php echo $rsqz['option3']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption3" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <b>Option 4</b>
                                            <textarea class="form-control" name="edoption4"
                                                      id="edoption4"><?php echo $rsqz['option4']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption4" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Option 5</b>
                                            <textarea class="form-control" name="edoption5"
                                                      id="edoption5"><?php echo $rsqz['option5']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption5" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <b>Option 6</b>
                                            <textarea class="form-control" name="edoption6"
                                                      id="edoption6"><?php echo $rsqz['option6']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption6" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Option 7</b>
                                            <textarea class="form-control" name="edoption5"
                                                      id="edoption5"><?php echo $rsqz['option7']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption5" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <b>Option 8</b>
                                            <textarea class="form-control" name="edoption6"
                                                      id="edoption6"><?php echo $rsqz['option8']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption6" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Option 9</b>
                                            <textarea class="form-control" name="edoption9"
                                                      id="edoption5"><?php echo $rsqz['option9']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption9" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6">
                                            <b>Option 10</b>
                                            <textarea class="form-control" name="edoption10"
                                                      id="edoption10"><?php echo $rsqz['option10']; ?></textarea>
                                            <span class="errmsg flash" id="erredoption10" style="color: red;"></span>
                                        </div>
                                    </div>
                                    <br>
                                    <?php
}
?>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Question Type*</b>
                                            <select class="form-control" name="edquestion_type" id="edquestion_type"
                                                    required>
                                                <option value=''>Select Answer</option>
                                                <?php
			$arr  = array("Radio Button","Check Box","Text Box");
			foreach($arr as $val)
			{
				if($rsqz['question_type'] == $val)
				{
				echo "<option value='$val' selected>$val</option>";
                                                }
                                                else
                                                {
                                                echo "
                                                <option value='$val'>$val</option>
                                                ";
                                                }
                                                }
                                                ?>
                                            </select>
                                            <span class="errmsg flash" id="erredquestion_type"
                                                  style="color: red;"></span>
                                        </div>
                                        <div class="col-md-4">
                                            <b>Image</b>
                                            <input type="file" class="form-control" name="edimg" id="edimg"
                                                   accept="image/*">
                                        </div>
                                        <div class="col-md-2"><br>
                                            <?php
if(isset($_GET['feedbacktopicid']))
{
	if(file_exists("imgquestion/".$rsqz['img']))
	{
?>
                                            <a href="imgquestion/<?php echo $rsqz['img']; ?>" class="btn btn-info"
                                               download>Download
                                                file</a>
                                            <?php
	}
}
?>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <b>Status*</b>
                                            <select class="form-control" name="edstatus" id="edstatus">
                                                <?php
			$arr  = array("Active","Inactive");
			foreach($arr as $val)
			{
				if($rsqz['status'] == $val)
				{
				echo "<option value='$val' selected>$val</option>";
                                                }
                                                else
                                                {
                                                echo "
                                                <option value='$val'>$val</option>
                                                ";
                                                }
                                                }
                                                ?>
                                            </select>
                                            <span class="errmsg flash" id="erredstatus" style="color: red;"></span>
                                        </div>
                                        <div class="col-md-6"><br>

                                        </div>
                                    </div>
                                    <br>

                                    <div class="card-footer">

                                        <div class="row">
                                            <div class="col-md-4"></div>
                                            <div class="col-md-4">
                                                <input class="form-control" type="submit" name="btnupdatequestion"
                                                       id="submitquestion" value="Click here to update">
                                            </div>
                                            <div class="col-md-4" style='text-align: right;'>
                                                <a class="btn btn-danger" name="img" id="img" style='color: white;'
                                                   href="feedbacktopicadmin.php?feedbackquestionid=<?php echo $rsqz[0]; ?>&feedbacktopicid=<?php echo $_GET['feedbacktopicid']; ?>"
                                                   onclick='return validatedel()'>Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.card-footer-->
                                </td>
                            </tr>
                            </tbody>
                        </table>

                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </form>
        </section>
    {% endif %}

{% endblock %}

{% block scripts %}
    <script>
        $(document).ready(function () {
            $('#tblquestionviewer').DataTable({
                "pageLength": 1,
                "bPaginate": true,
                "bLengthChange": false,
                "bFilter": true,
                "bInfo": false,
                "bAutoWidth": false
            });
        });
    </script>
    <script>
        function confirmvalidation() {
            let i = 0;
            $('.errmsg').html('');

            if (document.getElementById("testseries_topic").value === "") {
                document.getElementById("errtestseries_topic").innerHTML = "Topic should not be empty...";
                i = 1;
            }

            if (document.getElementById("categoryid").value === "") {
                document.getElementById("errcategoryid").innerHTML = "Kindly select the category...";
                i = 1;
            }
            if (document.getElementById("marksperquestion").value === "") {
                document.getElementById("errmarksperquestion").innerHTML = "Kindly enter the Corrent answer marks";
                i = 1;
            }
            if (document.getElementById("negativemarks").value === "") {
                document.getElementById("errnegativemarks").innerHTML = "Kindly enter negative mark";
                i = 1;
            }

            return i === 0;
        }
    </script>
    <script>
        function confirmvalidation1() {
            var i = 0;
            $('.errmsg').html('');
            if (document.getElementById("question").value === "") {
                document.getElementById("errquestion").innerHTML = "Question should not be empty...";
                i = 1;
            }
            if ($('#question_type').val() !== 'Text Box') {
                if (document.getElementById("option1").value === "") {
                    document.getElementById("erroption1").innerHTML = "Kindly enter Option 1...";
                    i = 1;
                }
                if (document.getElementById("question_type").value !== "Text Box") {
                    if (document.getElementById("option2").value === "") {
                        document.getElementById("erroption2").innerHTML = "Kindly enter Option 2...";
                        i = 1;
                    }
                }
            }
            if (document.getElementById("question_type").value === "") {
                document.getElementById("errquestion_type").innerHTML = "Kindly select Question Type...";
                i = 1;
            }
            return i === 0;
        }
    </script>
    <script>
        function confirmvalidation2() {
            var i = 0;
            $('.errmsg').html('');

            if (document.getElementById("edquestion").value === "") {
                document.getElementById("erredquestion").innerHTML = "Question should not be empty...";
                i = 1;
            }

            if (document.getElementById("edoption1").value === "") {
                document.getElementById("erredoption1").innerHTML = "Kindly enter Option 1...";
                i = 1;
            }

            if (document.getElementById("edoption2").value === "") {
                document.getElementById("erredoption2").innerHTML = "Kindly enter Option 2...";
                i = 1;
            }

            if (document.getElementById("edquestion_type").value !== "Text Box") {
                if (document.getElementById("edoption2").value === "") {
                    document.getElementById("erredoption2").innerHTML = "Kindly enter Option 2...";
                    i = 1;
                }
            }
            if (document.getElementById("edquestion_type").value === "") {
                document.getElementById("erredquestion_type").innerHTML = "Kindly select answer...";
                i = 1;
            }
            return i === 0;
        }
    </script>
    <script>
        function validatedel() {
            if (confirm("Are you sure want to delete this record?") === true) {
                return true;
            } else {
                return false;
            }
        }
    </script>
    <script>
        $('#question_type').change(function () {
            if ($('#question_type').val() === 'Text Box') {
                $('#idhidden').hide();
            } else {
                $('#idhidden').show();
            }
        });
    </script>
{% endblock %}